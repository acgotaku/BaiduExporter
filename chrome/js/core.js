!function(t){function e(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){function n(t,e){var a=new Object;a[t]=e,chrome.storage.sync.set(a,function(){})}"undefined"!=typeof browser&&(chrome=browser,chrome.storage.sync||(chrome.storage.sync=chrome.storage.local)),chrome.storage.sync.get(null,function(t){for(var e in t)localStorage.setItem(e,t[e])}),window.addEventListener("message",function(t){if(t.source==window){if(t.data.type&&"config_data"==t.data.type)for(var e in t.data.data)localStorage.setItem(e,t.data.data[e]),1==t.data.data.rpc_sync?n(e,t.data.data[e]):chrome.storage.sync.clear();t.data.type&&"clear_data"==t.data.type&&chrome.storage.sync.clear()}},!1);var r=function(){const t="netdisk;5.3.4.5;PC;PC-Windows;5.1.2600;WindowsBaiduYunGuanJia",e="http://pan.baidu.com/disk/home";var n=null,o=a(1);return{init:function(){window.showToast=o.showToast,window.sendToBackground=o.sendToBackground,window.copyText=o.copyText},escapeString:function(t){if(-1!=navigator.platform.indexOf("Win"))return t;var e="'"+t.replace("'","'\\''")+"'";return e},parseAuth:function(t){function e(t){return t.match(/^(?:(?![^:@]+:[^:@\/]*@)[^:\/?#.]+:)?(?:\/\/)?(?:([^:@]*(?::[^:@]*)?)?@)?/)[1]}function a(t){return t.replace(/^((?![^:@]+:[^:@\/]*@)[^:\/?#.]+:)?(\/\/)?(?:(?:[^:@]*(?::[^:@]*)?)?@)?(.*)/,"$1$2$3")}var n=e(t),r=[];n&&0!=n.indexOf("token:")&&(n="Basic "+btoa(n));var o=t.match(/^(?:[^#]*)(?:#(.*))?$/)[1];o&&o.split("&").forEach(function(t){t=t.split("="),t[0].length>1&&r.push([t[0],2==t.length?t[1]:"enabled"])});var i=a(t);return[n,i,r]},requestCookies:function(t){sendToBackground("get_cookies",t,function(t){return n=t})},getHeader:function(a){var r=[],o=localStorage.getItem("UA")||t,i=localStorage.getItem("headers"),d=localStorage.getItem("referer")||e;if(r.push("User-Agent: "+o),r.push("Referer: "+d),i)for(var s=i.split("\n"),l=0;l<s.length;l++)r.push(s[l]);if(n){var c=[];for(var p in n)c.push(p+"="+n[p]);r.push("Cookie: "+c.join(";"))}var u="";if("aria2c_line"==a){for(l=0;l<r.length;l++)u+=" --header "+JSON.stringify(r[l])+" ";return u}if("aria2c_txt"==a){for(l=0;l<r.length;l++)u+=" header="+r[l]+" \n";return u}if("idm_txt"==a){for(l=0;l<r.length;l++)u+=" header="+r[l]+" \n";return u}return r},setCenter:function(t){var e=$(window).width(),a=$(window).height(),n=$(document).scrollTop(),r=(e-t.width())/2,o=(a-t.height())/2+n;t.css({left:r+"px",top:o+"px"})},addMenu:{init:function(t){if(0!=$("#export_menu").length)return $("#export_menu");var e=$("<span>").attr("id","export_menu"),a=$("<div>").addClass("menu").attr("id","aria2_list").hide().appendTo(e),n=($("<a>").text("导出下载").addClass("g-button-menu").attr("id","aria2_download").appendTo(a),$("<a>").text("设置").addClass("g-button-menu").appendTo(a));return"home"==t?(e.addClass("g-dropdown-button button-open").prepend($("<a>").addClass("g-button").append($("<span>").addClass("g-button-right").append($("<em>").addClass("icon icon-device-tool"),$("<span>").addClass("text").text("导出下载")))),$(".g-dropdown-button").eq(3).after(e)):"share"==t?(e.addClass("save-button").append('<em class="global-icon-download"></em><b>导出下载</b>'),$('span a[class="new-dbtn"]').parent().prepend(e)):"album"==t&&(e.addClass("save-button").append('<em class="global-icon-download"></em><b>导出下载</b>'),$("#albumFileSaveKey, #emphsizeButton").parent().prepend(e)),e.mouseenter(function(){a.show()}),e.mouseleave(function(){a.hide()}),n.click(function(){0==$("#setting_div").length&&r.setting.init(),$("#setting_divtopmsg").html(""),$("#setting_div").show()}),this.update(),e},update:function(){$(".rpc_export_list").remove();for(var t=JSON.parse(localStorage.getItem("rpc_list")||'[{"name":"ARIA2 RPC","url":"http://localhost:6800/jsonrpc"}]');t.length>0;){var e=t.pop();$("<a class='rpc_export_list'>").addClass("g-button-menu").attr("data-id",e.url).text(e.name).prependTo($("#aria2_list"))}}},setting:{init:function(){var t=this,e=document.createElement("div");if(e.id="setting_div",0!=$("#setting_div").length)return e.id;var a=['<div class="top"><div title="关闭" id="setting_div_close" class="close"></div><h3>导出设置</h3></div>','<div style=" margin: 20px 10px 10px 10px; ">','<div id="setting_divtopmsg" style="position:absolute; margin-top: -18px; margin-left: 10px; color: #E15F00;"></div>','<table id="setting_div_table" >',"<tbody>",'<tr><td><label>开启配置同步:</label></td><td><input id="rpc_sync" type="checkbox"></td></tr>','<tr><td><label>文件夹结构层数：</label></td><td><input type="text" id="rpc_fold" class="input-small">(默认0表示不保留,-1表示保留完整路径)</td></tr>','<tr><td><label>递归下载延迟：</label></td><td><input type="text" id="rpc_delay" class="input-small">(单位:毫秒)<div style="position:absolute; margin-top: -20px; right: 20px;"><a id="send_test" type="0" href="javascript:;" >测试连接，成功显示版本号。</a></div></td></tr>','<tr><td><label>下载路径:</label></td><td><input type="text" placeholder="只能设置为绝对路径" id="setting_aria2_dir" class="input-large"></td></tr>','<tr><td><label>User-Agent :</label></td><td><input type="text" id="setting_aria2_useragent_input" class="input-large"></td></tr>','<tr><td><label>Referer ：</label></td><td><input type="text" id="setting_aria2_referer_input" class="input-large"></td></tr>','<tr><td colspan="2"><div style="color: #656565;">Headers<label style="margin-left: 65px;">※使用回车分隔每个headers。</label></div><li class="b-list-item separator-1"></li></td></tr>','<tr><td><label>headers ：</label></td><td><textarea id="setting_aria2_headers" ></textarea></td></tr>',"</tbody>","</table>",'<div style="margin-top:10px;">','<div id="copyright">© Copyright <a href="https://github.com/acgotaku/BaiduExporter">雪月秋水 </a><br/> Version:0.7.6 更新日期: 2016/05/28 </div>','<div style="margin-left:50px; display:inline-block"><a href="javascript:;" id="apply" class="button">应用</a><a href="javascript:;" id="reset" class="button">重置</a></div>',"</div>","</div>"];return e.innerHTML=a.join(""),document.body.appendChild(e),$("#setting_divtopmsg").html(""),t.update(),$("#setting_div").on("click",function(e){switch(e.target.id){case"setting_div_close":$("#setting_div").hide();break;case"apply":t.save(),setTimeout(function(){r.addMenu.update()},60),$("#setting_divtopmsg").html("设置已保存.");break;case"reset":localStorage.clear(),window.postMessage({type:"clear_data"},"*"),$("#setting_divtopmsg").html("设置已重置."),t.update();break;case"send_test":r.getVersion();break;case"add_rpc":var a=$(".rpc_list").length+1,n='<tr class="rpc_list"><td width="100"><input id="rpc_name_'+a+'" type="text" value="ARIA2 RPC '+a+'" class="input-medium">：</td><td><input id="rpc_url_'+a+'" type="text" class="input-large"></td></tr>';$(n).insertAfter($(".rpc_list").eq(a-2))}}),r.setCenter($("#setting_div")),e.id},save:function(){var t={};t.UA=document.getElementById("setting_aria2_useragent_input").value,t.rpc_delay=$("#rpc_delay").val(),t.referer=$("#setting_aria2_referer_input").val(),t.rpc_dir=$("#setting_aria2_dir").val(),t.rpc_fold=$("#rpc_fold").val(),t.rpc_headers=$("#setting_aria2_headers").val(),t.rpc_sync=$("#rpc_sync").prop("checked");for(var e=[],a=0;a<$(".rpc_list").length;a++){var n=a+1;""!=$("#rpc_url_"+n).val()&&""!=$("#rpc_name_"+n).val()&&e.push({name:$("#rpc_name_"+n).val(),url:$("#rpc_url_"+n).val()})}t.rpc_list=JSON.stringify(e),sendToBackground("config_data",t),window.postMessage({type:"config_data",data:t},"*")},update:function(){$("#rpc_delay").val(localStorage.getItem("rpc_delay")||"300"),$("#rpc_fold").val(localStorage.getItem("rpc_fold")||"0");var a=localStorage.getItem("rpc_sync");"false"==a?$("#rpc_sync").prop("checked",!1):$("#rpc_sync").prop("checked",!0),$("#setting_aria2_dir").val(localStorage.getItem("rpc_dir")),$("#setting_aria2_useragent_input").val(localStorage.getItem("UA")||t),$("#setting_aria2_referer_input").val(localStorage.getItem("referer")||e),$("#setting_aria2_headers").val(localStorage.getItem("rpc_headers"));var n=JSON.parse(localStorage.getItem("rpc_list")||'[{"name":"ARIA2 RPC","url":"http://localhost:6800/jsonrpc"}]');$(".rpc_list").remove();for(var r in n){var o=+r+1,i=1==o?'<a id="add_rpc" href="javascript:;" >ADD RPC</a>':"",d='<tr class="rpc_list"><td width="100"><input id="rpc_name_'+o+'" type="text" value="'+n[r].name+'" class="input-medium">：</td><td><input id="rpc_url_'+o+'" type="text" class="input-large" value="'+n[r].url+'">'+i+"</td></tr>";$(".rpc_list").length>0?$(d).insertAfter($(".rpc_list").eq(o-2)):$(d).prependTo($("#setting_div_table>tbody"))}}},getVersion:function(){var t={jsonrpc:"2.0",method:"aria2.getVersion",id:1,params:[]},e=$("#rpc_url_1").val(),a=r.parseAuth(e);a[0]&&a[0].startsWith("token")&&t.params.unshift(a[0]);var n={url:a[1],dataType:"json",type:"POST",data:JSON.stringify(t)};a[0]&&a[0].startsWith("Basic")&&(n.headers={Authorization:a[0]}),sendToBackground("rpc_version",n,function(t){t?$("#send_test").html("ARIA2版本为： "+response.data.result.version):$("#send_test").html("错误,请查看是否开启Aria2")})},aria2Data:function(t,e,a){var n=[],r=this;if(t.length>0)for(var o=t.length,i=0;o>i;i++){var d={jsonrpc:"2.0",method:"aria2.addUri",id:(new Date).getTime(),params:[[t[i].link],{out:t[i].name,dir:localStorage.getItem("rpc_dir")||null,header:r.getHeader()}]};if(console.log(a),a.length>0){var s=d.params[d.params.length-1];a.forEach(function(t){s[t[0]]=t[1]})}e&&0==e.indexOf("token:")&&d.params.unshift(e),n.push(d),console.log(d)}return n},dataBox:{init:function(t){if(0!=$("#download_ui").length)return this;var e=$("<div>").attr("id","download_ui").append('<div class="top"><a href="javascript:;" title="关闭" id="aria2_download_close" class="close"></a><h3><em></em>ARIA2导出</h3></div>'),a=$("<div>").addClass("content").attr("id","content_ui").appendTo(e);e.hide().appendTo($("body")),a.empty();var n=$("<div>").css({"margin-bottom":"10px"}).appendTo(a);$("<a>").attr("id","aria2c_btn").attr({download:"aria2c.down",target:"_blank"}).addClass("save-button ").html('<em class="global-icon-download"></em><b>存为aria2文件</b>').appendTo(n),$("<a>").attr("id","idm_btn").attr({download:"idm.txt",target:"_blank"}).addClass("save-button ").html('<em class="global-icon-download"></em><b>存为IDM文件</b>').appendTo(n),$("<a>").attr("id","download_txt_btn").attr({download:"download_link.txt",target:"_blank"}).addClass("save-button ").html('<em class="global-icon-download"></em><b>保存下载链接</b>').appendTo(n),$("<a>").attr("id","copy_txt_btn").attr({href:"javascript:void(0);",data:""}).addClass("save-button ").html('<em class="global-icon-download"></em><b>拷贝下载链接</b>').appendTo(n),$("<textarea>").attr({id:"download_link",wrap:"off",spellcheck:!1}).css({width:"100%",overflow:"scroll",height:"180px",resize:"none"}).appendTo(a);r.setCenter($("#download_ui")),$("#download_ui").on("click","#aria2_download_close",function(){navigator.msSaveBlob?$("#aria2c_btn, #idm_btn, #download_txt_btn").data("href",""):$("#aria2c_btn, #idm_btn, #download_txt_btn").attr("href","data:text/plain;charset=utf-8,"),$("#copy_txt_btn").attr("data",""),$("#download_link").val(""),e.hide()}),$("#download_ui").on("click","#copy_txt_btn",function(){copyText($("#copy_txt_btn").attr("data"))}),navigator.msSaveBlob?$("#aria2c_btn, #idm_btn, #download_txt_btn").click(function(t){t.preventDefault();var e=$(this);navigator.msSaveBlob(new Blob([e.data("href")]),e.attr("download"))}):$("#aria2c_btn, #idm_btn, #download_txt_btn").attr("href","data:text/plain;charset=utf-8,")},show:function(){$("#download_ui").show()},onClose:function(t){$("#download_ui").on("click","#aria2_download_close",t)},fillData:function(t){var e=[],a=[],n=[],o=[];if(t.length>0){for(var i=t.length,d=0;i>d;d++){var s=-1!=navigator.platform.indexOf("Win")?JSON.stringify(t[d].name):r.escapeString(t[d].name);e.push("aria2c -c -s10 -k1M -x10 -o "+s+r.getHeader("aria2c_line")+" "+JSON.stringify(t[d].link)+"\n"),a.push([t[d].link,r.getHeader("aria2c_txt")," out="+t[d].name," continue=true"," max-connection-per-server=10","  split=10","\n"].join("\n")),n.push(["<",t[d].link," out="+t[d].name," >"].join("\r\n")),o.push(t[d].link+"\n")}navigator.msSaveBlob?($("#aria2c_btn").data("href",$("#aria2c_btn").data("href")+a.join("")),$("#idm_btn").data("href",$("#idm_btn").data("href")+n.join("")),$("#download_txt_btn").data("href",$("#download_txt_btn").data("href")+o.join(""))):($("#aria2c_btn").attr("href",$("#aria2c_btn").attr("href")+encodeURIComponent(a.join(""))),$("#idm_btn").attr("href",$("#idm_btn").attr("href")+encodeURIComponent(n.join(""))),$("#download_txt_btn").attr("href",$("#download_txt_btn").attr("href")+encodeURIComponent(o.join("")))),$("#copy_txt_btn").attr("data",$("#copy_txt_btn").attr("data")+o.join("")),$("#download_link").val($("#download_link").val()+e.join(""))}}}}}();window.CORE=r},function(t,e){var a={sendToBackground:function(t,e,a){chrome.runtime.sendMessage({method:t,data:e},a)},HttpSend:function(t){return Promise.prototype.done=Promise.prototype.then,Promise.prototype.fail=Promise.prototype["catch"],new Promise(function(e,a){function n(){r.abort()}var r=new XMLHttpRequest,o="application/x-www-form-urlencoded; charset=UTF-8",i=3e3;null!=t.contentType&&(o=t.contentType),null!=t.timeout&&(i=t.timeout);var d=setTimeout(n,i);r.onreadystatechange=function(){4==r.readyState&&(200==r.status&&r.status<300||304==r.status?(clearTimeout(d),"json"==t.dataType?e(JSON.parse(r.responseText),r.status,r):"SCRIPT"==t.dataType&&e(r.responseText,r.status,r)):(clearTimeout(d),a(r,r.statusText,r.status)))},r.open(t.type,t.url,!0),r.setRequestHeader("Content-type",o);var s;for(s in t.headers)t.headers[s]&&r.setRequestHeader(s,t.headers[s]);"POST"==t.type?r.send(t.data):r.send()})},showToast:function(t,e){window.postMessage({type:"show_toast",data:{message:t,type:e}},"*")},copyText:function(t){var e=document.createElement("textarea");document.body.appendChild(e),e.style.position="fixed",e.style.left="0",e.style.top="0",e.value=t,e.focus(),e.select();var a=document.execCommand("copy");e.remove(),console.log(a),a?showToast("拷贝成功~","MODE_SUCCESS"):showToast("拷贝失败 QAQ","MODE_FAILURE")}};t.exports=a}]);